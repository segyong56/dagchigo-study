## 6.1 웹 중개자
* 웹 프락시 서버: 클라이언트 입장에서 트랜잭션을 수행하는 중개인.
  * 프락시 서버는 웹 클라이언트이자(서버에 요청 후, 응답 받음) 웹 서버(클라이언트에 요청 받고, 응답 전송)
    * 웹 클라이언트와, 서버의 규칙을 잘 따르도록 개발 해야함.
  * 트랜잭션은 완료하는 것이 클라이언트라는 점은 동일하지만, 프락시 서버가 제공하는 좋은 서비스를 이용

### 6.1.1 개인 프락시와 공유 프락시
**공용 프락시**
* 여러 클라이언트가 공유하는 프락시, 프락시는 대부분 공용 프락시.
* 중앙 집중형 프락시 관리가 더 비용효율이 높고 쉬우며, 캐시 프락시와 같은 몇 프락시 애플리케이션은 사용자가 많을 수록 공통된 요청에서 이득을 취할 수 있어 유리함.

**개인 프락시**
* 하나의 클라이언트를 위한 프락시, 흔하지 않지만 클라이언트 컴퓨터에서 직접 실행되는 형태로 꾸준히 사용됨
* 어떤 브라우저 보조 제품들은(ISP 서비스와 마찬가지로)브라우저 기능 확장, 성능 개선, 무료 ISP 서비스용 광고 운영을 위해 작은 프락시를 컴퓨터에서 직접 실행

### 6.1.2 프락시 대 게이트웨이
* 프락시: 같은 프로토콜을 사용하는 둘 이상의 애플리케이션 연결
* 게이트웨이: 다른 프로토콜을 사용하는 둘 이상의 애플리케이션 연결
* 실질적인 프락시와 게이트웨이의 차이점은 모호.
  * 브라우저와 서버는 다른 HTTP 버전을 구현하기 때문에, 프락시도 때때로 약간의 프로토콜 변환을 함
  * 상용 프락시 서버는 SSL 보안 프로토콜, SOCKS 방화벽, FTP 접근, 웹 기반 애플리케이션 지원을 위해 게이트웨이 기능 구현.

## 6.2 왜 프락시를 사용하는가?
* 프락시는 보안 개선, 성능 향상, 비용 절약이 가능.
* 프락시는 부가적인 가치를 주는 여러 유용한 웹 서비스를 구현하기 위해 HTTP 트래픽 감시, 수정 가능

**어린이 필터**
* 필터링 프락시: 특정 콘텐츠는 필터링을 위해 사용.
* 예: 교육컨텐츠는 제공하면서, 성인 콘텐츠는 차단함

**문서 접근 제어자**
* 접근 제어 프락시: 프락시 서버는 웹 서버들과 웹 리소스에 대한 단일한 접근 제어 전력을 구현하고, 감시 추적(audit trail)을 위해 사용
* 각기 다른 조직에서 관리되는 여러 종류의 많은 웹 서버에 대한 접근을 중앙 프락시에서 접근 제어설정 할 수 있음. 대기업 혹은 분산 관료 조직에 유용.
  * 예: 클라이언트 1은 제약없이 서버 A에 접근, 클라이언트 2는 서버 B에 접근 전에 비밀번호를 요구
* 고의적으로 제어 프락시를 피하는 것을 방지하기 위해, 웹 서버는 프락시 서버로부터의 요청만 받도록 설정할 수 있음.

**보안 방화벽**
* 보안 방화벽: 보안 강화를 위해 사용
* 들어가고 나가는 응용 레벨 프로토콜의 흐름을 네트워크 한 지점에서 통제.
* 트래픽을 세심히 살펴볼 수 있는 후크(hook)제공.
  * 바이러스를 제거하는 웹, 이메일 프락시가 사용할 수 있음.

**웹 캐시**
* 웹 캐시: 인기 있는 문서의 로컬 사본을 관리하고, 같은 문서의 요청에 빠르게 제공해 커뮤니케이션을 줄이기 위해 사용.

**대리 프락시**
* 대리 프락시(=리버스 프락시): 웹 서버인것처럼 위장하지만 웹 서버와 달리 요청 받은 콘텐츠를 찾기 위해 다른 서버와 커뮤니케이션
* 공용 콘텐츠에 대한 느린 웹 서버의 성능 개선을 위해 사용. 이 경우 대리 프락시를 서버 가속기라고 부름
* 콘텐츠 라우팅 기능과 결합해, 주문형 복체 컨텐츠의 분산 네트워크 만들기에 사용되기도 함.

**콘텐츠 라우터**
* 컨텐츠 라우터: 인터넷의 트래픽 조건과 콘텐츠 종류에 따라 요청을 특정 웹서버로 유도하여, 사용자에게 제공할 여러 서비스를 구현하는 데 사용
* 예시:
  * 사용자/콘텐츠 제공자가 성능을 위해 돈을 냈다면, 콘텐츠 라우터는 요청을 가까운 복제 캐시로 전달
  * 사용자가 필터링 서비스에 가입했다면, HTTP가 필터링 프락시를 통과하도록 함

**트랜스 코더**
* 트랜스 코딩: 데이터의 표현 방식을 자연스럽게 변환하는 것.
* 트랜스 코더: 콘텐츠를 클라이언트에 전달하기 전에 본문 포맷을 수정
  * 이미지를 GIF -> JPG로 변환하거나, 텍스트 파일을 압축하거나, 텍스트 크기를 변환한 웹 페이지를 생성하거나, 문서를 외국어 문서로 변환하는 것 등이 가능.

**익명화 프락시**
* HTTP메시지에서 신원을 식별 가능 특성들을 제거해 개인 정보 보호와 익명성 보장에 기여하기 위해 사용.
  * 신원 가능 특성: 클라이언트 IP주소, From 헤더, Refere 헤더, 쿠키, URI 세션 아이디 등
* 예시:
  1. 사용자의 메시지에 User-Agent헤더에서 컴퓨터, OS제거.
  2. 이메일 주소를 보호하기 위해 From헤더 제거
  3. 어떤 사이트를 거쳤는지 알기 어렵게 하기 위해 Referer헤더 제거
  4. 프로필과 신원 정보를 없애기 위해 Cookie헤더 제거

## 6.3 프락시는 어디에 있는가?
### 6.3.1 프락시 서버 배치
* 사용 방향에 따라 프락시는 어디에든 배치될 수 있으나, 배치 될 수 있느 몇가지 방법을 소개한다.

*출구(Egress)프락시*

```
클라이언트 <- (로컬 네트워크) -> 플락시 <- (인터넷) -> 서버
```

* 로컬 네트워크와 더 큰 인터넷을 오가는 트래픽 제어를 위해 로컬 네트워크 출구에 배치.
  * 방화벽 제공, 인터넷 요금 절약 및 인터넷 트래픽 성능 개선을 위해 회사에서 사용 가능.

  * 부적절한 콘텐츠 필터링을 위해 학교에서 사용 가능

*접근(입구) 프락시 = ISP 접근 프락시*
```
클라이언트 <--> 프락시 <- (인터넷) -> 서버
```
* 고객으로부터의 모든 요청을 종합적으로 처리하기위해 ISP 접근 지점에 위치.
  * ISP는 사용자들의 다운로드 속도 개선(특히 고속 접속 사용자), 인터넷 대역폭 비용을 줄이기 위해 캐시 프락시를 사용하여 사본을 저장.

*대리 프락시*
```
클라이언트 <- (인터넷) -> 프락시 <- (로컬 네트워크) -> 서버
```
* 네트워크의 가장 끝에 있는 웹 서버들의 바로 앞에 위치.
  * 웹 서버로 향하는 모든 요청을 처리하고, 필요할 때만 웹 서버에 자원 요청
  * 웹 서버에 보안기능을 추가
  * 빠른 웹 서버 캐시를 느린 웹 서버 앞에 놓음으로 성능 개선
* 대리 프락시는 일반적으로 웹 서버의 이름과 IP주소로 가장하기 때문에, 모든 요청은 서버가 아닌 프락시로 가게됨.

*네트워크 교환 프락시*
```
클라이언트 <- (네트워크1) -> 프락시 <- (네트워크2) -> 서버
```

* 네트워크 사이의 인터넷 피어링 교환 지점에 위치
  * 캐시를 이용해 인터넷 교차로의 혼잡을 완화, 트래픽 흐름을 감시하기 위해 사용

### 6.3.2 프락시 계층
*  프락시는 계층이라고 불리는 연쇄 구성 가능.
  * 프락시 계층에서 메세지는 최종적으로 원 서버/클라이언트에 도착할 때 까지 프락시와 프락시를 거쳐 이동.

* 프락시 계층에서, 다음번 인바운드 프락시(서버방향)을 부모, 다음번 아웃바운드 프락시(클라이언트 방향)을 자식이라고 부름.

*프락시 계층 콘텐츠 라우팅*
* 프락시 계층은 정적임. 프락시1 <-> 프락시2 <-> 프락시3
  * 계층이 반드시 정적이여야 하는 것은 아니며, 여러 판단 근거에 의해 유동적으로 보낼 수 있음

* 프락시가 상황에 맞게 부모 프락시나 서버에 라우팅하는 예
  * 요청된 객체가 콘텐츠 분산을 위해 돈을 지불한 웹 서버에 속하면, 프락시는 요청을 가까운 캐시서버에게 보내 캐시된 객체를 반환하거나, 그럴 수 없을 때는 원 서버에서 가져옴
  * 요청이 특정 종류의 이미지에 대한 경우, 접근 프락시는 요청을 특화된 압축 프락시에게 보내 그 프락시가 이미지를 가져와 압축하여 느린 모뎀으로 접속해도 빠르게 다운로드 할 수 있게 함

* 동적 부모 선택의 예
  * 부하 균형
    * 자식 프락시는 부하를 분산하기 위해 현재 부모의 작업량 수준에 근거하여 부모 프락시 선택
  * 지리적 인접성에 근거한 라우팅
    * 자식 프락시는 원 서버의 지역을 담당하는 부모를 선택할 수 있음
  * 프로토콜/타입 라우팅
    * 자식 프락시는 URIR에 근거하여 다른 부모 / 원 서버로 라우팅 할 수 있음.
    * 특정 종류의 URI 요청을 특별한 프락시 서버로 보내 특별한 프로토콜로 처리할 수도 있음.
  * 유료 서비스 가입자를 위한 라우팅
    * 빠른 서비스를 위해 추가금을 지불했다면, URI는 대쳥 캐시나 성능 개선을 위한 압축 엔진으로 라우칭
* 동적 부모 라우팅 로직은 제품(설정 파일, 스크립트 언어, 동적 실행 기능 플로그인 등) 마다 다르게 구현됨

### 6.3.3 어떻게 프락시가 트래픽을 처리하는가
* 클라이언트 트래픽이 프락시로 가도록 만드는 방법은 4가지가 있음

*클라이언트를 수정한다*
* 브라우저를 포함한 많은 웹 클라이언트들은 수동/자동 프락시 설정을 지원.
* 클라이언트가 프락시를 사용하도록 설정되어있다면, 클라이언트는 HTTP요청을 바로/ 의도적으로 원서버가 아닌 프락시로 보냄

*네트워크 수정한다*
* 클라이언트가 모르는 상태에서, 네트워크 인프라를 가로채 웹 트래픽을 프락시로 조정하는 기법이 있음.
* 일반적으로 가로채기 위해 HTTP 프래픽을 지켜보고, 프락시로 보내는 스위칭 장칭와 라우팅 장치를 필요로함.
  * 인터셉트 프락시(= 투명 프락시)라고 함

*DNS 이름 공간 수정한다*
* 대리 프락시는 웹 서버의 이름과 IP주소를 직접 사용. 모든 요청은 대리프락시로 감
* DNS 이름 테이블을 수동으로 편집 혹은 적절한 프락시나 서버를 계산해주는 특별한 동적 DNS 이용해서 조정됨

*웹 서버 수정 한다*
* 웹 서버가 HTTP리다이렉션(305)를 클라이언트에게 돌려주어, 요청이 프락시로 리다이렉트 되도록 설정
* 리다이렉트를 받은 클라이언트는 프락시와 트랜잭션 시작

## 6.4 클라이언트 프락시 설정
* 모든 현대적인 브라우저는 프락시를 사용할 수 있도록 설정 가능.
* 브라우저는 프락시를 설정하는 여러 방법 제공
  * 수동 설정/ 브라우저 기본 설정/ 프락시 자동설정(PAC) / WPAD 프락시 발견

### 6.4.1 클라이언트 프락시 설정: 수돟
* 프락시를 사용하겠다고 명시적 설정하는 방법으로, 프락시의 호스트와 포트를 지정.
* 단순하지만 유연하지 못하고, 단 하나의 프락시 서버만 지정가능.
* 장애시의 대체 작동 지원도 없고, 큰 조직에서 관리 문제 야기

### 6.4.2 클라이언트 프락시 설정: PAC 파일
* 프락시 자동설정(Proxy auto-configuration, PAC)은 프락시 설정을 상황에 맞게 계산해주는 자바스크립트 프로그램
* 브라우저 설정에 PAC파일의 URI를 설정하면, 브라우저는 매 접근마다 적절한 프락시서버 계산을 위해 PAC 자바스크립트 로직 이용.
* 확장자는 .pac, MIME 타입은 'application/x-ns-proxy-autoconfig'

```
function FindProxyForUrl(url, host) {
  if(url.substring(0, 5) === "http:") {
    return "PROXY http-proxy.mydomain.com:8080";
  } else if() {
    return "PROXY ftp-proxy.mydomain.com:8080";
  } else {
     return "DIRECT";
  }
}

```
